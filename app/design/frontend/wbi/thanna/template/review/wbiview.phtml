<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category    design
 * @package     base_default
 * @copyright   Copyright (c) 2013 Magento Inc. (http://www.magentocommerce.com)
 * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */
?>

<?php if ($this->getAllowWriteReviewFlag()): ?>
<h6>Noter ce produit</h6>
    <div class="rating-all-box">
        <?php if ($this->getRatingSummary($this->product)): ?>
            <div class="rating-box">
                <div class="rating" style="width:<?php echo $this->getRatingSummary($this->product) ?>%"></div>
            </div>
        <?php endif; ?>


        <?php if ($this->getRatings() && $this->getRatings()->getSize()): ?>

            <div class="starRate">

                <?php foreach ($this->getRatings() as $_rating): ?>
                    <div><b class="bold"></b></div>
                    <ul>
                        <?php $_options = $this->getSortedOptions($_rating->getOptions()) ?>
                        <?php $last = false; ?>
                        <?php foreach ($_options as $_option): ?>
                            <?php $_option == end($_options) ? $last = true : $last = false; ?>
                            <li id="ratings_<?php echo $_rating->getId() . "_" . $_option->getId() ?>" data-rating="<?php echo $_rating->getId() ?>" data-value="<?php echo $_option->getId() ?>" data-name="ratings[<?php echo $_rating->getId() ?>]"><a href="javascript:void(0)"><span>Give it <?php echo $_option->getId() ?> stars</span><b class="<?php echo $last ? 'bold' : '' ?>"></b></a></li>
                        <?php endforeach; ?>
                    </ul>
                <?php endforeach; ?>
            </div>
        <?php endif; ?>
    </div>
    <script type="text/javascript">
        $jq(".starRate ul").find("li").on("click", function(){
            $jq(".starRate ul li").find("b").removeClass("bold");
            $jq(this).find("b").addClass("bold");
            $jq(".rating-box").hide();
            $jq(".starRate").css("display", "block");
            $jq.ajax({
                url: "<?php echo $this->getWbiAction() ?>",
                async : false,
                data: $jq(this).data("name")+"="+$jq(this).data("value"),
                type: "POST",
                complete: function(){ $jq("#loading-mask").attr("style", "display:none") },
                beforeSend: function(){ $jq("#loading-mask").attr("style", "display:block") }
            });
        });
                                
    </script>
<?php else: ?>
    <p class="review-nologged" id="review-form">
        <?php echo $this->__('Only registered users can write reviews. Please, <a href="%s">log in</a> or <a href="%s">register</a>', $this->getLoginLink(), Mage::helper('customer')->getRegisterUrl()) ?>
    </p>
        <?php endif ?>
